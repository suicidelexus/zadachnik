<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Task Tracker{% endblock %}</title>

    <!-- Tailwind CSS + DaisyUI (UI Components Library) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.6.0/dist/full.min.css" rel="stylesheet" type="text/css" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- SortableJS –¥–ª—è drag-and-drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Overlay –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar glass-effect" id="sidebar">
            <div class="sidebar-header">
                <!-- –ö–Ω–æ–ø–∫–∞-–±—É—Ä–≥–µ—Ä -->
                <button class="menu-toggle-btn-inside" id="menuToggleBtn" onclick="toggleSidebar()">
                    <span class="material-icons-round">menu</span>
                </button>

                <!-- –õ–æ–≥–æ—Ç–∏–ø —Å —Ä–∞–∫–µ—Ç–æ–π –∏ –∑–≤—ë–∑–¥–∞–º–∏ -->
                <div class="logo-container">
                    <div class="logo-icon animated-rocket-stars">
                        <span class="material-icons-round">rocket_launch</span>
                        <div class="star star-1">‚ú¶</div>
                        <div class="star star-2">‚ú¶</div>
                        <div class="star star-3">‚ú¶</div>
                    </div>
                </div>

                <h1 class="logo-text-animated">Self's Product Board</h1>
            </div>

            <ul class="nav-menu">
                <!-- –†–∞–∑–¥–µ–ª: –û—Å–Ω–æ–≤–Ω–æ–π -->
                <li class="nav-section-title">
                    <span>–û—Å–Ω–æ–≤–Ω–æ–π</span>
                </li>
                <li class="nav-item {% if request.endpoint == 'dashboard' %}active{% endif %}">
                    <a href="/dashboard">
                        <span class="material-icons-round">insights</span>
                        <span>–î–∞—à–±–æ—Ä–¥</span>
                    </a>
                </li>
                <li class="nav-item {% if request.endpoint == 'kanban' or request.endpoint == 'index' %}active{% endif %}">
                    <a href="/kanban">
                        <span class="material-icons-round">view_kanban</span>
                        <span>–ö–∞–Ω–±–∞–Ω</span>
                    </a>
                </li>

                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –≥—Ä—É–ø–ø—ã -->
                <div id="sidebarGroupsContainer"></div>

                <li class="nav-divider"></li>

                <!-- –†–∞–∑–¥–µ–ª: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
                <li class="nav-section-title">
                    <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                </li>
                <li class="nav-item {% if request.endpoint == 'rice_kanban' %}active{% endif %}">
                    <a href="/rice/kanban">
                        <span class="material-icons-round">analytics</span>
                        <span>Priority Score: –ö–∞–Ω–±–∞–Ω</span>
                    </a>
                </li>
                <li class="nav-item {% if request.endpoint == 'rice_ideas' %}active{% endif %}">
                    <a href="/rice/ideas">
                        <span class="material-icons-round">lightbulb</span>
                        <span>Priority Score</span>
                    </a>
                </li>
                <li class="nav-item {% if request.endpoint == 'eisenhower' %}active{% endif %}">
                    <a href="/eisenhower">
                        <span class="material-icons-round">grid_view</span>
                        <span>–ú–∞—Ç—Ä–∏—Ü–∞ –≠–π–∑–µ–Ω—Ö–∞—É—ç—Ä–∞</span>
                    </a>
                </li>

                <li class="nav-divider"></li>

                <!-- –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ (–æ—Ç–¥–µ–ª—å–Ω–æ) -->
                <li class="nav-item {% if request.endpoint == 'done' %}active{% endif %}">
                    <a href="/done">
                        <span class="material-icons-round">done_all</span>
                        <span>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</span>
                    </a>
                </li>
            </ul>

            <div class="sidebar-footer">
                <button class="theme-toggle glass-button compact" onclick="openHelpModal()" title="–°–ø—Ä–∞–≤–∫–∞ Priority Score">
                    <span class="material-icons-round" style="font-size: 18px;">help_outline</span>
                </button>
                <button class="theme-toggle glass-button compact" onclick="openUsersModal()" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏">
                    <span class="material-icons-round" style="font-size: 18px;">group</span>
                </button>
                <button class="theme-toggle glass-button compact" onclick="toggleTheme()">
                    <span class="material-icons-round" id="theme-icon" style="font-size: 18px;">dark_mode</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-wrapper fade-in">
                {% block content %}{% endblock %}
            </div>
        </main>

        <!-- Side Drawer –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–¥–∞—á–∏ –≤ Table —Ä–µ–∂–∏–º–µ -->
        <div id="taskSideDrawer" class="task-side-drawer">
            <div class="side-drawer-overlay" onclick="closeSideDrawer()"></div>
            <div class="side-drawer-content">
                <div class="side-drawer-header">
                    <h3 class="text-lg font-semibold">–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞—á–∏</h3>
                    <button onclick="closeSideDrawer()" class="btn btn-sm btn-circle btn-ghost">
                        <span class="material-icons-round">close</span>
                    </button>
                </div>
                <div id="sideDrawerBody" class="side-drawer-body">
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ - DaisyUI dialog -->
    <dialog id="taskModal" class="modal">
        <div class="modal-box w-11/12 max-w-3xl">
            <form method="dialog">
                <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">‚úï</button>
            </form>
            <h3 class="font-bold text-lg mb-4" id="modalTitle">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h3>

            <form id="taskForm" class="space-y-4" onsubmit="return false;">
                <input type="hidden" id="taskId">

                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium">–ù–∞–∑–≤–∞–Ω–∏–µ *</span>
                    </label>
                    <input type="text" id="title" name="title" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"
                           class="input input-bordered w-full">
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium">–°—Å—ã–ª–∫–∞ –Ω–∞ –ò–¥–µ–∏—á–Ω—É—é</span>
                    </label>
                    <input type="url" id="ideichnaya_link" name="ideichnaya_link" placeholder="https://..."
                           class="input input-bordered w-full">
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium">–û–ø–∏—Å–∞–Ω–∏–µ</span>
                    </label>
                    <textarea id="description" name="description" rows="3" placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É..."
                              class="textarea textarea-bordered w-full"></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">–ü–æ—Å—Ç–∞–Ω–æ–≤—â–∏–∫</span>
                        </label>
                        <input type="text" id="assignee" name="assignee" placeholder="–ò–º—è"
                               class="input input-bordered w-full">
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</span>
                        </label>
                        <input type="text" id="executor" name="executor" placeholder="–ò–º—è"
                               class="input input-bordered w-full">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</span>
                        </label>
                        <select id="priority" name="priority" class="select select-bordered w-full">
                            <option value="Low">Low</option>
                            <option value="Medium" selected>Medium</option>
                            <option value="High">High</option>
                            <option value="Highest">Highest</option>
                        </select>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">–°—Ç–∞—Ç—É—Å</span>
                        </label>
                        <select id="status" name="status" class="select select-bordered w-full">
                            <option value="New">New</option>
                            <option value="Collecting">Collecting</option>
                            <option value="Ready for Dev">Ready for Dev</option>
                            <option value="In Dev">In Dev</option>
                            <option value="Ready for Release">Ready for Release</option>
                            <option value="Done">Done</option>
                        </select>
                    </div>
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium">–¢–µ–≥–∏</span>
                    </label>
                    <div id="tagsContainer" class="tags-container flex flex-wrap gap-2"></div>
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium">–ì—Ä—É–ø–ø–∞</span>
                    </label>
                    <select id="group_id" name="group_id" class="select select-bordered select-sm w-full">
                        <option value="">–ë–µ–∑ –≥—Ä—É–ø–ø—ã</option>
                    </select>
                </div>

                <div class="divider">Priority Score</div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Value (1-5)</span>
                        </label>
                        <select id="rice_value" name="rice_value" class="select select-bordered select-sm w-full">
                            <option value="">‚Äî</option>
                            <option value="1">1 ‚Äî –£–¥–æ–±–Ω–æ</option>
                            <option value="2">2 ‚Äî –õ–æ–∫–∞–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ</option>
                            <option value="3">3 ‚Äî –°–Ω–∏–º–∞–µ—Ç –±–æ–ª—å</option>
                            <option value="4">4 ‚Äî –£–ª—É—á—à–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π</option>
                            <option value="5">5 ‚Äî –ú–µ–Ω—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ</option>
                        </select>
                    </div>

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Reach (1-5)</span>
                        </label>
                        <select id="rice_reach" name="rice_reach" class="select select-bordered select-sm w-full">
                            <option value="">‚Äî</option>
                            <option value="1">1 ‚Äî –ï–¥–∏–Ω–∏—á–Ω—ã–µ –∫–µ–π—Å—ã</option>
                            <option value="2">2 ‚Äî –ù–µ–±–æ–ª—å—à–æ–π —Å–µ–≥–º–µ–Ω—Ç</option>
                            <option value="3">3 ‚Äî –ó–Ω–∞—á–∏–º—ã–π —Å–µ–≥–º–µ–Ω—Ç</option>
                            <option value="4">4 ‚Äî –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ</option>
                            <option value="5">5 ‚Äî –ü–æ—á—Ç–∏ –≤—Å–µ</option>
                        </select>
                    </div>

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Budget Impact</span>
                        </label>
                        <select id="budget_impact" name="budget_impact" class="select select-bordered select-sm w-full">
                            <option value="">‚Äî</option>
                            <option value="1.0" selected>1.0</option>
                            <option value="1.2">1.2</option>
                            <option value="1.5">1.5</option>
                            <option value="2.0">2.0</option>
                        </select>
                    </div>

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Confidence (%)</span>
                        </label>
                        <input type="number" id="rice_confidence" name="rice_confidence" min="0" max="100"
                               placeholder="0-100" class="input input-bordered input-sm w-full">
                    </div>
                </div>

                <div class="divider">–ú–∞—Ç—Ä–∏—Ü–∞ –≠–π–∑–µ–Ω—Ö–∞—É—ç—Ä–∞</div>
                <p class="text-sm text-base-content/60 mb-3">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ –æ–¥–Ω–æ–º—É –ø—É–Ω–∫—Ç—É –∏–∑ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="card bg-base-200">
                        <div class="card-body p-4">
                            <h4 class="font-semibold mb-2">–í–∞–∂–Ω–æ—Å—Ç—å</h4>
                            <div class="space-y-2">
                                <label class="label cursor-pointer justify-start gap-2">
                                    <input type="radio" name="eisenhower_importance" value="important" class="radio radio-sm">
                                    <span class="label-text">–í–∞–∂–Ω–æ</span>
                                </label>
                                <label class="label cursor-pointer justify-start gap-2">
                                    <input type="radio" name="eisenhower_importance" value="not_important" class="radio radio-sm">
                                    <span class="label-text">–ù–µ –≤–∞–∂–Ω–æ</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-base-200">
                        <div class="card-body p-4">
                            <h4 class="font-semibold mb-2">–°—Ä–æ—á–Ω–æ—Å—Ç—å</h4>
                            <div class="space-y-2">
                                <label class="label cursor-pointer justify-start gap-2">
                                    <input type="radio" name="eisenhower_urgency" value="urgent" class="radio radio-sm">
                                    <span class="label-text">–°—Ä–æ—á–Ω–æ</span>
                                </label>
                                <label class="label cursor-pointer justify-start gap-2">
                                    <input type="radio" name="eisenhower_urgency" value="not_urgent" class="radio radio-sm">
                                    <span class="label-text">–ù–µ —Å—Ä–æ—á–Ω–æ</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="eisenhowerError" class="alert alert-error mt-3" style="display: none;">
                    <span>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ –æ–¥–Ω–æ–º—É –ø—É–Ω–∫—Ç—É –∏–∑ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –æ–±–∞ –ø—É—Å—Ç—ã–º–∏</span>
                </div>

                <div class="modal-action">
                    <button type="button" class="btn btn-ghost" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons-round">save</span>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- Modal –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–¥–∞—á–∏ -->
    <dialog id="viewTaskModal" class="modal">
        <div class="modal-content modal-large glass-modal">
            <div class="modal-header">
                <h2 id="viewTaskTitle">–ó–∞–¥–∞—á–∞</h2>
                <div class="modal-actions">
                    <button class="icon-btn" onclick="editCurrentTask()" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                        <span class="material-icons-round">edit</span>
                    </button>
                    <button class="icon-btn danger" onclick="deleteCurrentTask()" title="–£–¥–∞–ª–∏—Ç—å">
                        <span class="material-icons-round">delete</span>
                    </button>
                    <button class="close-btn" onclick="closeViewModal()">
                        <span class="material-icons-round">close</span>
                    </button>
                </div>
            </div>
            <div id="viewTaskContent" class="task-details"></div>

            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
            <div class="comments-section">
                <h3>
                    <span class="material-icons-round">chat_bubble</span>
                    –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                </h3>
                <div id="commentsList" class="comments-list"></div>
                <form id="commentForm" class="comment-form">
                    <div class="form-group">
                        <input type="text" id="commentAuthor" placeholder="–í–∞—à–µ –∏–º—è">
                    </div>
                    <div class="form-group">
                        <textarea id="commentText" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." rows="2"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-sm">
                        <span class="material-icons-round">add_comment</span>
                        –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                </form>
            </div>
        </div>
    </dialog>

    <!-- Modal –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞–º–∏ –∏ –≥—Ä—É–ø–ø–∞–º–∏ -->
    <dialog id="tagsModal" class="modal">
        <div class="modal-content glass-modal">
            <div class="modal-header">
                <h2>
                    <span class="material-icons-round">label</span>
                    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞–º–∏ –∏ –≥—Ä—É–ø–ø–∞–º–∏
                </h2>
                <button class="close-btn" onclick="closeTagsModal()">
                    <span class="material-icons-round">close</span>
                </button>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∏ –¥–ª—è —Ç–µ–≥–æ–≤ –∏ –≥—Ä—É–ø–ø -->
            <div role="tablist" class="tabs tabs-boxed mb-4 mx-4">
                <a role="tab" class="tab tab-active" onclick="switchTab('tags')">–¢–µ–≥–∏</a>
                <a role="tab" class="tab" onclick="switchTab('groups')">–ì—Ä—É–ø–ø—ã</a>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ç–µ–≥–æ–≤ -->
            <div id="tagsContent" class="tags-manager">
                <form id="newTagForm" class="new-tag-form">
                    <input type="text" id="newTagName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞" required class="flex-1">
                    <input type="text" id="newTagEmoji" placeholder="üè∑Ô∏è" maxlength="2" class="w-16 text-center text-2xl">
                    <input type="color" id="newTagColor" value="#14b8a6" class="w-16">
                    <button type="submit" class="btn btn-primary btn-sm">
                        <span class="material-icons-round">add</span>
                    </button>
                </form>
                <div id="tagsList" class="tags-list"></div>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≥—Ä—É–ø–ø -->
            <div id="groupsContent" class="tags-manager" style="display: none;">
                <form id="newGroupForm" class="new-tag-form">
                    <input type="text" id="newGroupName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã" required class="flex-1">
                    <input type="text" id="newGroupIcon" placeholder="üìÅ" maxlength="2" class="w-16 text-center text-2xl">
                    <input type="color" id="newGroupColor" value="#6366f1" class="w-16">
                    <button type="submit" class="btn btn-primary btn-sm">
                        <span class="material-icons-round">add</span>
                    </button>
                </form>
                <div id="groupsList" class="tags-list"></div>
            </div>
        </div>
    </dialog>

    <!-- Modal –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª–æ–≤ -->
    <dialog id="importModal" class="modal">
        <div class="modal-content glass-modal">
            <div class="modal-header">
                <h2>
                    <span class="material-icons-round">upload_file</span>
                    –ò–º–ø–æ—Ä—Ç –∑–∞–¥–∞—á
                </h2>
                <button class="close-btn" onclick="closeImportModal()">
                    <span class="material-icons-round">close</span>
                </button>
            </div>
            <div class="import-content">
                <div class="import-dropzone" id="importDropzone">
                    <span class="material-icons-round">cloud_upload</span>
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                    <span class="import-formats">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: .xlsx, .csv</span>
                    <input type="file" id="importFileInput" accept=".xlsx,.xls,.csv" hidden>
                </div>
                <div class="import-info">
                    <h4>–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã:</h4>
                    <ul>
                        <li><strong>–ù–∞–∑–≤–∞–Ω–∏–µ</strong> ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</li>
                        <li><strong>–°—Å—ã–ª–∫–∞</strong> (–∏–ª–∏ "–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–¥–µ–∏—á–Ω—É—é") ‚Äî URL</li>
                        <li><strong>–û–ø–∏—Å–∞–Ω–∏–µ</strong> ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</li>
                        <li><strong>–ü–æ—Å—Ç–∞–Ω–æ–≤—â–∏–∫</strong> ‚Äî –∫—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–ª –∑–∞–¥–∞—á—É</li>
                        <li><strong>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</strong> ‚Äî –∫—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç</li>
                        <li><strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</strong> ‚Äî Low, Medium, High, Highest</li>
                        <li><strong>–°—Ç–∞—Ç—É—Å</strong> ‚Äî New, Collecting, Ready for Dev, In Dev, Ready for Release, Done</li>
                    </ul>
                    <a href="/api/import/template" class="btn btn-secondary btn-sm">
                        <span class="material-icons-round">download</span>
                        –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω
                    </a>
                </div>
                <div class="import-progress" id="importProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p id="progressText">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
                <div class="import-result" id="importResult" style="display: none;"></div>
            </div>
        </div>
    </dialog>

    <!-- Modal –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
    <dialog id="usersModal" class="modal">
        <div class="modal-content glass-modal">
            <div class="modal-header">
                <h2>
                    <span class="material-icons-round">group</span>
                    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
                </h2>
                <button class="close-btn" onclick="closeUsersModal()">
                    <span class="material-icons-round">close</span>
                </button>
            </div>
            <div class="users-manager">
                <div class="new-user-form">
                    <div class="avatar-trigger" id="avatarPreview" onclick="toggleAvatarSelector()">
                        üë§
                    </div>
                    <div class="form-group">
                        <label for="newUserName">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="newUserName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è...">
                    </div>
                    <button class="btn btn-primary btn-sm" onclick="saveUser()">
                        <span class="material-icons-round">add</span>
                    </button>
                </div>

                <div id="avatarSelectorContainer" style="display: none; margin-bottom: 16px;">
                    <label style="font-size: 0.8rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; display: block;">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä:</label>
                    <div class="avatar-selector" id="avatarSelector"></div>

                    <label style="font-size: 0.8rem; font-weight: 600; color: var(--text-secondary); margin: 12px 0 8px; display: block;">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç:</label>
                    <div class="color-selector">
                        <div class="color-option selected" style="background-color: #14b8a6" onclick="selectColor('#14b8a6')"></div>
                        <div class="color-option" style="background-color: #6366f1" onclick="selectColor('#6366f1')"></div>
                        <div class="color-option" style="background-color: #8b5cf6" onclick="selectColor('#8b5cf6')"></div>
                        <div class="color-option" style="background-color: #ec4899" onclick="selectColor('#ec4899')"></div>
                        <div class="color-option" style="background-color: #ef4444" onclick="selectColor('#ef4444')"></div>
                        <div class="color-option" style="background-color: #f59e0b" onclick="selectColor('#f59e0b')"></div>
                        <div class="color-option" style="background-color: #22c55e" onclick="selectColor('#22c55e')"></div>
                        <div class="color-option" style="background-color: #3b82f6" onclick="selectColor('#3b82f6')"></div>
                        <div class="color-option" style="background-color: #06b6d4" onclick="selectColor('#06b6d4')"></div>
                        <div class="color-option" style="background-color: #78716c" onclick="selectColor('#78716c')"></div>
                    </div>
                </div>

                <div id="usersList" class="users-list"></div>
            </div>
        </div>
    </dialog>

    <!-- Modal –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Priority Score -->
    <dialog class="modal" id="helpModal">
        <div class="modal-box w-11/12 max-w-5xl max-h-[90vh] p-0 overflow-hidden">
            <div class="flex h-full">
                <!-- Sidebar —Å –º–µ–Ω—é —Ä–∞–∑–¥–µ–ª–æ–≤ -->
                <div class="w-64 bg-base-200 p-6 flex flex-col gap-2 border-r border-base-300">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="material-icons-round text-primary">analytics</span>
                        –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
                    </h3>
                    <button class="btn btn-sm justify-start gap-2 doc-menu-item active" onclick="switchDocSection('metrics')">
                        <span class="material-icons-round text-sm">analytics</span>
                        <span>–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π</span>
                    </button>
                    <button class="btn btn-sm justify-start gap-2 doc-menu-item" onclick="switchDocSection('decision')">
                        <span class="material-icons-round text-sm">psychology</span>
                        <span>–ö–∞–∫ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ</span>
                    </button>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
                <div class="flex-1 p-8 overflow-y-auto">
                    <form method="dialog">
                        <button class="btn btn-sm btn-circle btn-ghost absolute right-6 top-6">‚úï</button>
                    </form>

                    <!-- –†–∞–∑–¥–µ–ª: –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π -->
                    <div id="doc-section-metrics" class="doc-section">
                        <h2 class="text-2xl font-bold mb-6">üìä –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π Priority Score</h2>

                        <!-- –§–æ—Ä–º—É–ª–∞ -->
                        <div class="alert alert-info mb-6">
                            <div>
                                <h3 class="font-bold text-lg">–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á—ë—Ç–∞</h3>
                                <p class="text-base mt-2">
                                    Priority Score = <strong>(Value √ó Reach √ó Budget Impact) √ó Confidence</strong>
                                </p>
                            </div>
                        </div>

                        <!-- –ú–µ—Ç—Ä–∏–∫–∏ –≤ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <!-- Value -->
                            <div class="card bg-base-200 shadow-sm">
                                <div class="card-body p-5">
                                    <h4 class="card-title text-base flex items-center gap-2">
                                        <span class="material-icons-round text-primary">trending_up</span>
                                        Value (1-5)
                                    </h4>
                                    <div class="text-sm space-y-2 mt-2">
                                        <p><strong>1</strong> ‚Äî ¬´–£–¥–æ–±–Ω–æ¬ª</p>
                                        <p><strong>3</strong> ‚Äî ¬´–°–Ω–∏–º–∞–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω—É—é –±–æ–ª—å¬ª</p>
                                        <p><strong>5</strong> ‚Äî ¬´–ú–µ–Ω—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π¬ª</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Reach -->
                            <div class="card bg-base-200 shadow-sm">
                                <div class="card-body p-5">
                                    <h4 class="card-title text-base flex items-center gap-2">
                                        <span class="material-icons-round text-primary">groups</span>
                                        Reach (1-5)
                                    </h4>
                                    <div class="text-sm space-y-2 mt-2">
                                        <p><strong>1</strong> ‚Äî –µ–¥–∏–Ω–∏—á–Ω—ã–µ –∫–µ–π—Å—ã</p>
                                        <p><strong>3</strong> ‚Äî –∑–Ω–∞—á–∏–º—ã–π —Å–µ–≥–º–µ–Ω—Ç</p>
                                        <p><strong>5</strong> ‚Äî –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Budget Impact -->
                            <div class="card bg-base-200 shadow-sm">
                                <div class="card-body p-5">
                                    <h4 class="card-title text-base flex items-center gap-2">
                                        <span class="material-icons-round text-primary">attach_money</span>
                                        Budget Impact
                                    </h4>
                                    <div class="text-sm space-y-2 mt-2">
                                        <p><strong>1.0</strong> ‚Äî –ë–µ–∑ –∑–∞–º–µ—Ç–Ω–æ–≥–æ –∏–º–ø–∞–∫—Ç–∞</p>
                                        <p><strong>1.2</strong> ‚Äî –ù–µ–±–æ–ª—å—à–æ–π –ø—Ä–∏—Ä–æ—Å—Ç</p>
                                        <p><strong>1.5</strong> ‚Äî –ó–Ω–∞—á–∏–º—ã–π –ø—Ä–∏—Ä–æ—Å—Ç</p>
                                        <p><strong>2.0</strong> ‚Äî –í—ã—Å–æ–∫–∏–π —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Confidence -->
                            <div class="card bg-base-200 shadow-sm">
                                <div class="card-body p-5">
                                    <h4 class="card-title text-base flex items-center gap-2">
                                        <span class="material-icons-round text-primary">verified</span>
                                        Confidence (0-100%)
                                    </h4>
                                    <div class="text-sm space-y-2 mt-2">
                                        <p><strong>100%</strong> ‚Äî –µ—Å—Ç—å –≥–æ—Ç–æ–≤–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</p>
                                        <p><strong>80%</strong> ‚Äî –µ—Å—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –¶–ê</p>
                                        <p><strong>60%</strong> ‚Äî –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</p>
                                        <p><strong>40%</strong> ‚Äî –≥–∏–ø–æ—Ç–µ–∑–∞ –∏ —Å–∏–≥–Ω–∞–ª—ã</p>
                                        <p><strong>20%</strong> ‚Äî –∏–Ω—Ç—É–∏—Ü–∏—è</p>
                                        <p><strong>0%</strong> ‚Äî –Ω–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∏–π</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è -->
                        <div class="card bg-base-100 shadow-md">
                            <div class="card-body">
                                <h3 class="text-xl font-bold mb-4">üìà –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</h3>
                                <div class="overflow-x-auto">
                                    <table class="table table-zebra">
                                        <thead>
                                            <tr>
                                                <th class="w-28">Score</th>
                                                <th>–†–µ—à–µ–Ω–∏–µ –ø–æ —Ñ–∏—á–µ</th>
                                                <th>–ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-success/10">
                                                <td class="font-bold">35‚Äì50</td>
                                                <td class="font-semibold">üî• –ë–µ—Ä—ë–º –≤ —Ä–∞–±–æ—Ç—É</td>
                                                <td class="text-sm">–§–∏—á–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø–µ—Ä–µ–¥–∞—á–µ –≤ –ø—Ä–æ–¥—É–∫—Ç / –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ delivery. –¶–µ–Ω–Ω–æ—Å—Ç—å, –æ—Ö–≤–∞—Ç –∏ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã.</td>
                                            </tr>
                                            <tr class="bg-warning/10">
                                                <td class="font-bold">20‚Äì34</td>
                                                <td class="font-semibold">üü® –ö–∞–Ω–¥–∏–¥–∞—Ç –≤ —Ä–∞–±–æ—Ç—É</td>
                                                <td class="text-sm">–§–∏—á–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π: effort, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —Ç–∞–π–º–∏–Ω–≥. –ò–¥—ë—Ç –≤ –≤–µ—Ä—Ö –±—ç–∫–ª–æ–≥–∞.</td>
                                            </tr>
                                            <tr class="bg-info/10">
                                                <td class="font-bold">8‚Äì19</td>
                                                <td class="font-semibold">üü¶ –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ç–æ—á–Ω–µ–Ω–∏–µ (Discovery)</td>
                                                <td class="text-sm">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –µ—Å—Ç—å, –Ω–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏–ª–∏ –º–∞—Å—à—Ç–∞–±–∞. –ù—É–∂–Ω—ã —Ä–µ—Å–µ—Ä—á, –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ—Ç–æ—Ç–∏–ø –∏–ª–∏ spike.</td>
                                            </tr>
                                            <tr class="bg-base-200">
                                                <td class="font-bold">0‚Äì7</td>
                                                <td class="font-semibold">‚ö™ –ù–µ –±–µ—Ä—ë–º –≤ —Ä–∞–±–æ—Ç—É</td>
                                                <td class="text-sm">–ò–¥–µ—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Icebox. –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–≤–æ–¥–Ω—ã—Ö (–¥–∞–Ω–Ω—ã–µ, –∫–æ–Ω—Ç–µ–∫—Å—Ç, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è).</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –†–∞–∑–¥–µ–ª: –ö–∞–∫ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ -->
                    <div id="doc-section-decision" class="doc-section" style="display: none;">
                        <h2 class="text-2xl font-bold mb-6">üéØ –ö–∞–∫ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ</h2>
                        <p class="mb-6 text-base-content/70">–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –ø–æ–º–æ–≥–∞–µ—Ç –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á.</p>

                        <div class="space-y-6">
                            <!-- –®–∞–≥ 1 -->
                            <div class="card bg-base-200 shadow-sm">
                                <div class="card-body">
                                    <h3 class="text-lg font-bold flex items-center gap-2">
                                        <span class="badge badge-primary badge-lg">1</span>
                                        –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ü–µ–ª—å (–æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å ¬´–ó–∞—á–µ–º?¬ª)
                                    </h3>
                                    <div class="mt-3 space-y-2 text-sm">
                                        <p>–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —á—ë—Ç–∫–æ –ø–æ–Ω—è—Ç—å:</p>
                                        <ul class="list-disc list-inside space-y-1 ml-4">
                                            <li>–∑–∞—á–µ–º –º—ã –¥–µ–ª–∞–µ–º —ç—Ç—É —Ñ–∏—á—É;</li>
                                            <li>–∫–∞–∫—É—é –ø—Ä–æ–±–ª–µ–º—É –æ–Ω–∞ —Ä–µ—à–∞–µ—Ç;</li>
                                            <li>–¥–ª—è –∫–æ–≥–æ –æ–Ω–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –±–∏–∑–Ω–µ—Å, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∫–æ–º–∞–Ω–¥–∞);</li>
                                            <li>–∫–∞–∫—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å –æ–Ω–∞ –ø—Ä–∏–Ω–æ—Å–∏—Ç.</li>
                                        </ul>
                                        <div class="alert alert-warning mt-3">
                                            <span class="material-icons-round">warning</span>
                                            <span>–ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å ¬´–∑–∞—á–µ–º¬ª, —Ä–µ—à–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –®–∞–≥ 2 -->
                            <div class="card bg-base-200 shadow-sm">
                                <div class="card-body">
                                    <h3 class="text-lg font-bold flex items-center gap-2">
                                        <span class="badge badge-primary badge-lg">2</span>
                                        –°—Ä–∞–≤–Ω–∏—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ä–µ—à–µ–Ω–∏–µ–º
                                    </h3>
                                    <div class="mt-3 space-y-2 text-sm">
                                        <p>–î–∞–ª–µ–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ä–µ—à–µ–Ω–∏–µ —ç—Ç–æ–π –∑–∞–¥–∞—á–∏:</p>
                                        <ul class="list-disc list-inside space-y-1 ml-4">
                                            <li>—Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ—Ö–æ–∂–∞—è —Ñ–∏—á–∞ –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å;</li>
                                            <li>—á–µ–º –Ω–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ;</li>
                                            <li>—É–ª—É—á—à–∞–µ—Ç –ª–∏ –æ–Ω–æ –º–µ—Ç—Ä–∏–∫–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –∏–ª–∏ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã;</li>
                                            <li>–º–æ–∂–Ω–æ –ª–∏ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ.</li>
                                        </ul>
                                        <div class="alert alert-info mt-3">
                                            <span class="material-icons-round">info</span>
                                            <span>–¶–µ–ª—å —à–∞–≥–∞ ‚Äî –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ª–∏—à–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –®–∞–≥ 3 -->
                            <div class="card bg-base-200 shadow-sm">
                                <div class="card-body">
                                    <h3 class="text-lg font-bold flex items-center gap-2">
                                        <span class="badge badge-primary badge-lg">3</span>
                                        –û—Ü–µ–Ω–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –±—é–¥–∂–µ—Ç (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
                                    </h3>
                                    <div class="mt-3 space-y-2 text-sm">
                                        <p>–ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è, –Ω—É–∂–Ω–æ:</p>
                                        <ul class="list-disc list-inside space-y-1 ml-4">
                                            <li>–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏;</li>
                                            <li>–æ—Ü–µ–Ω–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—É—é —ç–∫–æ–Ω–æ–º–∏—é –∏–ª–∏ —Ä–æ—Å—Ç –¥–æ—Ö–æ–¥–∞;</li>
                                            <li>–ø–æ–Ω—è—Ç—å, —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –ª–∏ —Ä–µ—à–µ–Ω–∏–µ –≤ —Ç–µ–∫—É—â–∏–π –±—é–¥–∂–µ—Ç.</li>
                                        </ul>
                                        <div class="alert alert-success mt-3">
                                            <span class="material-icons-round">check_circle</span>
                                            <span>–≠—Ç–æ—Ç —à–∞–≥ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç—å –≤–∑–≤–µ—à–µ–Ω–Ω–æ–µ –±–∏–∑–Ω–µ—Å-—Ä–µ—à–µ–Ω–∏–µ.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –®–∞–≥ 4 -->
                            <div class="card bg-base-200 shadow-sm">
                                <div class="card-body">
                                    <h3 class="text-lg font-bold flex items-center gap-2">
                                        <span class="badge badge-primary badge-lg">4</span>
                                        –û—Ü–µ–Ω–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –≤—Ä–µ–º—è (–µ—Å–ª–∏ –±—é–¥–∂–µ—Ç –ø–æ—Å—á–∏—Ç–∞—Ç—å –Ω–µ–ª—å–∑—è)
                                    </h3>
                                    <div class="mt-3 space-y-2 text-sm">
                                        <p>–ï—Å–ª–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –æ—Ü–µ–Ω–∫—É —Å–¥–µ–ª–∞—Ç—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:</p>
                                        <ul class="list-disc list-inside space-y-1 ml-4">
                                            <li>–æ—Ü–µ–Ω–∏—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ);</li>
                                            <li>–ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç –æ—Ç–ª–æ–∂–µ–Ω—ã –∏–ª–∏ –≤—ã—Ç–µ—Å–Ω–µ–Ω—ã;</li>
                                            <li>–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ä–æ—á–Ω–æ—Å—Ç—å –∏ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ roadmap.</li>
                                        </ul>
                                        <div class="alert alert-info mt-3">
                                            <span class="material-icons-round">schedule</span>
                                            <span>–í—Ä–µ–º—è –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—â–∏–π —Ä–µ—Å—É—Ä—Å.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </dialog>

    {% block modals %}{% endblock %}


    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    {% block scripts %}{% endblock %}

    <script>

        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ë–û–ö–û–í–´–ú –ú–ï–ù–Æ ====================
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const isCollapsed = sidebar.classList.contains('collapsed');

            if (isCollapsed) {
                openSidebar();
            } else {
                closeSidebar();
            }
        }

        function openSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            sidebar.classList.remove('collapsed');
            document.body.classList.remove('sidebar-collapsed');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º overlay —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö/–ø–ª–∞–Ω—à–µ—Ç–∞—Ö
            if (window.innerWidth < 1024) {
                overlay.classList.add('active');
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            localStorage.setItem('sidebarCollapsed', 'false');
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            sidebar.classList.add('collapsed');
            document.body.classList.add('sidebar-collapsed');
            overlay.classList.remove('active');

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            localStorage.setItem('sidebarCollapsed', 'true');
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø—É–Ω–∫—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.sidebar .nav-item a');

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    const sidebar = document.getElementById('sidebar');
                    const isCollapsed = sidebar.classList.contains('collapsed');

                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö/–ø–ª–∞–Ω—à–µ—Ç–∞—Ö
                    // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –≤ collapsed —Ä–µ–∂–∏–º–µ –ù–ï —Ç—Ä–æ–≥–∞–µ–º –º–µ–Ω—é (–∏–∑–±–µ–≥–∞–µ–º –º–æ—Ä–≥–∞–Ω–∏—è)
                    if (window.innerWidth < 1024) {
                        // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –≤—Å–µ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–µ–º
                        if (!this.getAttribute('onclick') || !this.getAttribute('onclick').includes('toggleSubmenu')) {
                            closeSidebar();
                        }
                    }
                    // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –≤ collapsed —Ä–µ–∂–∏–º–µ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º - –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ —Å—Å—ã–ª–∫–µ
                });
            });

            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–Ω—é –∏–∑ localStorage
            const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            const sidebar = document.getElementById('sidebar');

            // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            if (window.innerWidth >= 1024) {
                if (isCollapsed) {
                    sidebar.classList.add('collapsed');
                    document.body.classList.add('sidebar-collapsed');
                } else {
                    sidebar.classList.remove('collapsed');
                    document.body.classList.remove('sidebar-collapsed');
                }
            } else {
                // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö/–ø–ª–∞–Ω—à–µ—Ç–∞—Ö –≤—Å–µ–≥–¥–∞ –∑–∞–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                sidebar.classList.add('collapsed');
                document.body.classList.add('sidebar-collapsed');
            }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            let resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    const overlay = document.getElementById('sidebarOverlay');

                    if (window.innerWidth >= 1024) {
                        // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ —É–±–∏—Ä–∞–µ–º overlay
                        overlay.classList.remove('active');
                    } else {
                        // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
                        closeSidebar();
                    }
                }, 250);
            });
        });

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–ø—Ä–∞–≤–∫–∏ Priority Score
        function openHelpModal() {
            const modal = document.getElementById('helpModal');

            // –ï—Å–ª–∏ –º–æ–¥–∞–ª–∫–∞ –µ—Å—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ - –æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ—ë
            if (modal) {
                if (modal.tagName === 'DIALOG') {
                    modal.showModal();
                } else {
                    modal.classList.add('active');
                }

                // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–µ–∫—Ü–∏–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —Ä–∞–∑–¥–µ–ª
                if (typeof switchDocSection === 'function') {
                    switchDocSection('metrics');
                }
            } else {
                // –ï—Å–ª–∏ –º–æ–¥–∞–ª–∫–∏ –Ω–µ—Ç - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Priority Score
                window.location.href = '/rice/ideas';
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–ø—Ä–∞–≤–∫–∏
        function closeHelpModal() {
            const modal = document.getElementById('helpModal');
            if (modal) {
                if (modal.tagName === 'DIALOG') {
                    modal.close();
                } else {
                    modal.classList.remove('active');
                }
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –∑–∞–¥–∞—á–∏
        function openSideDrawer(taskId) {
            const drawer = document.getElementById('taskSideDrawer');
            drawer.classList.add('active');

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
            fetch(`/api/tasks/${taskId}`)
                .then(response => response.json())
                .then(task => {
                    renderTaskInSideDrawer(task);
                })
                .catch(error => {
                    console.error('Error loading task:', error);
                    closeSideDrawer();
                });
        }

        function closeSideDrawer() {
            const drawer = document.getElementById('taskSideDrawer');
            drawer.classList.remove('active');
        }

        function renderTaskInSideDrawer(task) {
            const body = document.getElementById('sideDrawerBody');

            const statusClass = task.status.toLowerCase().replace(/ /g, '-');
            const statusBadgeClass = {
                'new': 'badge-info',
                'collecting': 'badge-warning',
                'ready-for-dev': 'badge-primary',
                'in-dev': 'badge-accent',
                'ready-for-release': 'badge-success',
                'done': 'badge-success'
            }[statusClass] || 'badge-ghost';

            const priorityClass = task.priority.toLowerCase();
            const priorityBadgeClass = {
                'low': 'badge-success',
                'medium': 'badge-warning',
                'high': 'badge-error',
                'highest': 'badge-secondary'
            }[priorityClass] || 'badge-ghost';

            body.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <h2 class="text-xl font-semibold mb-2">${task.title}</h2>
                        <div class="flex gap-2 flex-wrap">
                            <span class="badge ${statusBadgeClass}">${task.status}</span>
                            <span class="badge ${priorityBadgeClass}">${task.priority}</span>
                            ${task.rice_score ? `<span class="badge badge-secondary">Score: ${task.rice_score.toFixed(1)}</span>` : ''}
                        </div>
                    </div>

                    ${task.ideichnaya_link ? `
                        <div>
                            <label class="text-sm font-medium text-base-content/60">–°—Å—ã–ª–∫–∞ –Ω–∞ –ò–¥–µ–∏—á–Ω—É—é</label>
                            <div class="mt-1">
                                <a href="${task.ideichnaya_link}" target="_blank" class="link link-primary flex items-center gap-1">
                                    ${task.ideichnaya_link}
                                    <span class="material-icons-round text-sm">open_in_new</span>
                                </a>
                            </div>
                        </div>
                    ` : ''}

                    ${task.description ? `
                        <div>
                            <label class="text-sm font-medium text-base-content/60">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <p class="mt-1 text-base-content">${task.description}</p>
                        </div>
                    ` : ''}

                    <div class="grid grid-cols-2 gap-4">
                        ${task.assignee ? `
                            <div>
                                <label class="text-sm font-medium text-base-content/60">–ü–æ—Å—Ç–∞–Ω–æ–≤—â–∏–∫</label>
                                <p class="mt-1">${task.assignee}</p>
                            </div>
                        ` : ''}

                        ${task.executor ? `
                            <div>
                                <label class="text-sm font-medium text-base-content/60">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</label>
                                <p class="mt-1">${task.executor}</p>
                            </div>
                        ` : ''}
                    </div>

                    ${task.tags && task.tags.length > 0 ? `
                        <div>
                            <label class="text-sm font-medium text-base-content/60">–¢–µ–≥–∏</label>
                            <div class="flex gap-2 flex-wrap mt-2">
                                ${task.tags.map(tag => `<span class="badge badge-outline" style="border-color: ${tag.color}; color: ${tag.color}">${tag.name}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <div class="flex gap-2 pt-4 border-t border-base-300">
                        <button onclick="editTaskFromDrawer(${task.id})" class="btn btn-primary btn-sm flex-1">
                            <span class="material-icons-round mr-1">edit</span>
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button onclick="closeSideDrawer()" class="btn btn-ghost btn-sm">
                            –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            `;
        }

        function editTaskFromDrawer(taskId) {
            closeSideDrawer();
            if (typeof openModal === 'function') {
                openModal(taskId);
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const drawer = document.getElementById('taskSideDrawer');
                if (drawer && drawer.classList.contains('active')) {
                    closeSideDrawer();
                }
            }
        });

        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ì–†–£–ü–ü–ê–ú–ò ====================

        function switchTab(tab) {
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tabs .tab').forEach(t => {
                t.classList.remove('tab-active');
            });
            event.target.classList.add('tab-active');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            if (tab === 'tags') {
                document.getElementById('tagsContent').style.display = 'block';
                document.getElementById('groupsContent').style.display = 'none';
            } else {
                document.getElementById('tagsContent').style.display = 'none';
                document.getElementById('groupsContent').style.display = 'block';
                loadGroupsList();
            }
        }

        async function loadGroupsList() {
            try {
                const response = await fetch('/api/groups');
                const groups = await response.json();

                const container = document.getElementById('groupsList');
                container.innerHTML = groups.map(group => `
                    <div class="tag-item">
                        <div class="tag-info">
                            <span class="tag-emoji">${group.icon || 'üìÅ'}</span>
                            <span class="tag-color-preview" style="background-color: ${group.color}"></span>
                            <span class="tag-name">${group.name}</span>
                        </div>
                        <button class="icon-btn danger" onclick="deleteGroup(${group.id})" title="–£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É">
                            <span class="material-icons-round">close</span>
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading groups:', error);
            }
        }

        async function loadGroupsForSelect() {
            try {
                const response = await fetch('/api/groups');
                const groups = await response.json();

                const select = document.getElementById('group_id');
                if (select) {
                    select.innerHTML = '<option value="">–ë–µ–∑ –≥—Ä—É–ø–ø—ã</option>' +
                        groups.map(group => `<option value="${group.id}">${group.icon || 'üìÅ'} ${group.name}</option>`).join('');
                }
            } catch (error) {
                console.error('Error loading groups for select:', error);
            }
        }

        async function deleteGroup(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –≥—Ä—É–ø–ø—É? –ó–∞–¥–∞—á–∏ –Ω–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) return;

            try {
                const response = await fetch(`/api/groups/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    loadGroupsList();
                    loadGroupsForSelect();
                    // –û–±–Ω–æ–≤–ª—è–µ–º sidebar
                    loadSidebarGroups();
                }
            } catch (error) {
                console.error('Error deleting group:', error);
            }
        }

        // –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã
        document.addEventListener('DOMContentLoaded', function() {
            const newGroupForm = document.getElementById('newGroupForm');
            if (newGroupForm) {
                newGroupForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const name = document.getElementById('newGroupName').value;
                    const color = document.getElementById('newGroupColor').value;
                    const icon = document.getElementById('newGroupIcon').value || 'üìÅ';

                    try {
                        const response = await fetch('/api/groups', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ name, color, icon })
                        });

                        if (response.ok) {
                            document.getElementById('newGroupName').value = '';
                            document.getElementById('newGroupIcon').value = '';
                            loadGroupsList();
                            loadGroupsForSelect();
                            // –û–±–Ω–æ–≤–ª—è–µ–º sidebar
                            loadSidebarGroups();
                        } else {
                            const error = await response.json();
                            alert(error.error || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã');
                        }
                    } catch (error) {
                        console.error('Error creating group:', error);
                    }
                });
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä—É–ø–ø—ã –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏
            loadGroupsForSelect();
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø –≤ sidebar
        async function loadSidebarGroups() {
            try {
                const response = await fetch('/api/groups');
                const groups = await response.json();

                const groupsContainer = document.getElementById('sidebarGroupsContainer');
                if (groupsContainer) {
                    groupsContainer.innerHTML = groups.map(group => `
                        <li class="nav-item">
                            <a href="/group/${group.id}">
                                <span class="text-xl">${group.icon || 'üìÅ'}</span>
                                <span>${group.name}</span>
                            </a>
                        </li>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading sidebar groups:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä—É–ø–ø—ã –≤ sidebar –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadSidebarGroups);

        // ==================== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –†–ê–ó–î–ï–õ–û–í –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò ====================
        function switchDocSection(sectionName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã
            document.querySelectorAll('.doc-section').forEach(section => {
                section.style.display = 'none';
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª
            const targetSection = document.getElementById(`doc-section-${sectionName}`);
            if (targetSection) {
                targetSection.style.display = 'block';
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –º–µ–Ω—é
            document.querySelectorAll('.doc-menu-item').forEach(item => {
                item.classList.remove('active', 'btn-primary');
                item.classList.add('btn-ghost');
            });

            // –ü–æ–º–µ—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –ø—É–Ω–∫—Ç –º–µ–Ω—é
            event.currentTarget.classList.remove('btn-ghost');
            event.currentTarget.classList.add('active', 'btn-primary');
        }

        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò ====================
        let selectedAvatar = 'default';
        let selectedColor = '#14b8a6';
        let editingUserId = null;

        function openUsersModal() {
            const modal = document.getElementById('usersModal');
            if (modal) {
                modal.showModal();
                loadUsers();
                loadAvatarSelector();
            }
        }

        function closeUsersModal() {
            const modal = document.getElementById('usersModal');
            if (modal) {
                modal.close();
            }
        }

        function toggleAvatarSelector() {
            const container = document.getElementById('avatarSelectorContainer');
            if (container.style.display === 'none') {
                container.style.display = 'block';
            } else {
                container.style.display = 'none';
            }
        }

        async function loadAvatarSelector() {
            const avatars = ['üë§', 'üë®', 'üë©', 'üßë', 'üë®‚Äçüíª', 'üë©‚Äçüíª', 'üë®‚Äçüíº', 'üë©‚Äçüíº', 'üßë‚Äçüíº', 'üë®‚Äçüî¨', 'üë©‚Äçüî¨', 'üßë‚Äçüî¨', 'üë®‚Äçüé®', 'üë©‚Äçüé®', 'üßë‚Äçüé®', 'ü¶∏', 'ü¶π', 'üßô', 'üßö', 'üßõ'];
            const selector = document.getElementById('avatarSelector');
            selector.innerHTML = avatars.map(avatar =>
                `<div class="avatar-option ${avatar === selectedAvatar ? 'selected' : ''}" onclick="selectAvatar('${avatar}')">${avatar}</div>`
            ).join('');
        }

        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            document.getElementById('avatarPreview').textContent = avatar;

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±–æ—Ä –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–µ
            document.querySelectorAll('.avatar-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }

        function selectColor(color) {
            selectedColor = color;

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±–æ—Ä –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–µ
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }

        async function saveUser() {
            const name = document.getElementById('newUserName').value.trim();

            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }

            try {
                const method = editingUserId ? 'PUT' : 'POST';
                const url = editingUserId ? `/api/users/${editingUserId}` : '/api/users';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        avatar: selectedAvatar,
                        color: selectedColor
                    })
                });

                if (response.ok) {
                    document.getElementById('newUserName').value = '';
                    selectedAvatar = 'default';
                    selectedColor = '#14b8a6';
                    editingUserId = null;
                    document.getElementById('avatarPreview').textContent = 'üë§';
                    document.getElementById('avatarSelectorContainer').style.display = 'none';
                    loadUsers();
                } else {
                    const error = await response.json();
                    alert(error.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                }
            } catch (error) {
                console.error('Error saving user:', error);
            }
        }

        async function loadUsers() {
            try {
                const response = await fetch('/api/users');
                const users = await response.json();

                const usersList = document.getElementById('usersList');
                usersList.innerHTML = users.map(user => `
                    <div class="user-item">
                        <div class="user-avatar" style="background-color: ${user.color}20; border-color: ${user.color};">
                            ${user.avatar}
                        </div>
                        <div class="user-info">
                            <div class="user-name">${user.name}</div>
                        </div>
                        <button class="btn btn-sm btn-ghost" onclick="editUser(${user.id}, '${user.name}', '${user.avatar}', '${user.color}')">
                            <span class="material-icons-round text-sm">edit</span>
                        </button>
                        <button class="btn btn-sm btn-ghost btn-error" onclick="deleteUser(${user.id})">
                            <span class="material-icons-round text-sm">delete</span>
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function editUser(id, name, avatar, color) {
            editingUserId = id;
            document.getElementById('newUserName').value = name;
            selectedAvatar = avatar;
            selectedColor = color;
            document.getElementById('avatarPreview').textContent = avatar;
            document.getElementById('avatarSelectorContainer').style.display = 'block';

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±–æ—Ä –∞–≤–∞—Ç–∞—Ä–∞
            document.querySelectorAll('.avatar-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.textContent === avatar) {
                    opt.classList.add('selected');
                }
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.style.backgroundColor === color) {
                    opt.classList.add('selected');
                }
            });
        }

        async function deleteUser(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) return;

            try {
                const response = await fetch(`/api/users/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    loadUsers();
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                }
            } catch (error) {
                console.error('Error deleting user:', error);
            }
        }
    </script>
</body>
</html>
