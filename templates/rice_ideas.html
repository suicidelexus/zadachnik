{% extends "base.html" %}

{% block title %}Priority Score: –ò–¥–µ–∏ - Task Tracker{% endblock %}

{% block content %}
<div class="w-full">
<div class="flex justify-between items-center mb-5 flex-wrap gap-3">
    <h1 class="text-2xl font-semibold text-base-content">Priority Score</h1>
    <div class="flex gap-2 items-center flex-wrap">
        <button class="btn btn-primary btn-sm" onclick="openRiceIdeaModal()">
            <span class="material-icons-round" style="font-size: 16px;">add</span>
            <span class="ml-1">–ù–æ–≤–∞—è –∏–¥–µ—è</span>
        </button>
    </div>
</div>

<div class="rice-info">
    <div class="rice-header-row">
        <div class="scoring-ranges">
            <h4 class="text-sm font-semibold mb-3">üìä –î–∏–∞–ø–∞–∑–æ–Ω—ã —Å–∫–æ—Ä–∏–Ω–≥–∞</h4>
            <div class="range-items">
                <div class="range-item range-high">
                    <span class="range-score">35‚Äì50</span>
                    <span class="material-icons-round range-icon">local_fire_department</span>
                    <span class="range-text">–ë–µ—Ä—ë–º –≤ —Ä–∞–±–æ—Ç—É</span>
                </div>
                <div class="range-item range-medium">
                    <span class="range-score">20‚Äì34</span>
                    <span class="material-icons-round range-icon">pending</span>
                    <span class="range-text">–ö–∞–Ω–¥–∏–¥–∞—Ç –≤ —Ä–∞–±–æ—Ç—É</span>
                </div>
                <div class="range-item range-low">
                    <span class="range-score">8‚Äì19</span>
                    <span class="material-icons-round range-icon">schedule</span>
                    <span class="range-text">–¢—Ä–µ–±—É–µ—Ç—Å—è Discovery</span>
                </div>
                <div class="range-item range-none">
                    <span class="range-score">0‚Äì7</span>
                    <span class="material-icons-round range-icon">remove_circle_outline</span>
                    <span class="range-text">–ù–µ –±–µ—Ä—ë–º –≤ —Ä–∞–±–æ—Ç—É</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="rice-table-container">
    <table class="rice-table">
        <thead>
            <tr>
                <th>–ò–¥–µ—è</th>
                <th>Value</th>
                <th>Reach</th>
                <th>Budget</th>
                <th>Confidence</th>
                <th class="score-col">Priority Score</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody id="riceIdeasBody"></tbody>
    </table>
    <div id="emptyState" class="empty-state" style="display: none;">
        <span class="material-icons-round">lightbulb</span>
        <p>–ù–µ—Ç Priority Score-–∏–¥–µ–π</p>
        <p class="empty-hint">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∏–¥–µ—é –¥–ª—è –æ—Ü–µ–Ω–∫–∏</p>
    </div>
</div>

</div><!-- –ó–∞–∫—Ä—ã–≤–∞–µ–º max-w wrapper -->
{% endblock %}

{% block modals %}
<!-- Modal –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Priority Score-–∏–¥–µ–∏ -->
<dialog class="modal" id="riceIdeaModal">
    <div class="modal-content modal-wider glass-modal">
        <div class="modal-header">
            <h2 id="riceIdeaModalTitle">–ù–æ–≤–∞—è Priority Score-–∏–¥–µ—è</h2>
            <button class="close-btn" onclick="closeRiceIdeaModal()">
                <span class="material-icons-round">close</span>
            </button>
        </div>
        <form id="riceIdeaForm">
            <input type="hidden" id="riceIdeaId">

            <div class="form-group">
                <label for="riceIdeaTitle">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                <input type="text" id="riceIdeaTitle" name="title" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–¥–µ–∏">
            </div>

            <div class="form-group">
                <label for="riceIdeaDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="riceIdeaDescription" name="description" rows="3" placeholder="–û–ø–∏—à–∏—Ç–µ –∏–¥–µ—é..."></textarea>
            </div>

            <div class="form-row rice-row-4">
                <div class="form-group">
                    <label for="riceIdeaValue">Value *</label>
                    <select id="riceIdeaValue" name="value" required>
                        <option value="">‚Äî</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="riceIdeaReach">Reach *</label>
                    <select id="riceIdeaReach" name="reach" required>
                        <option value="">‚Äî</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="riceIdeaBudget">Budget Impact *</label>
                    <select id="riceIdeaBudget" name="budget_impact" required>
                        <option value="">‚Äî</option>
                        <option value="1.0" selected>1.0</option>
                        <option value="1.2">1.2</option>
                        <option value="1.5">1.5</option>
                        <option value="2.0">2.0</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="riceIdeaConfidence">Confidence, % *</label>
                    <input type="number" id="riceIdeaConfidence" name="confidence" min="0" max="100" required placeholder="0-100">
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeRiceIdeaModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">
                    <span class="material-icons-round">save</span>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </form>
    </div>
</dialog>

<!-- Modal –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Priority Score -->
<dialog class="modal" id="helpModal">
    <div class="modal-content modal-documentation glass-modal">
        <div class="modal-header">
            <h2>üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Priority Score</h2>
            <button class="close-btn" onclick="closeHelpModal()">
                <span class="material-icons-round">close</span>
            </button>
        </div>
        <div class="documentation-container">
            <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
            <div class="doc-sidebar">
                <div class="doc-menu-item active" onclick="switchDocSection('metrics')">
                    <span class="material-icons-round">analytics</span>
                    <span>–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π</span>
                </div>
                <div class="doc-menu-item" onclick="switchDocSection('decision')">
                    <span class="material-icons-round">psychology</span>
                    <span>–ö–∞–∫ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ</span>
                </div>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="doc-content">
                <!-- –†–∞–∑–¥–µ–ª 1: –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π -->
                <div id="doc-metrics" class="doc-section active">
                    <h3>üìä –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π</h3>

                    <!-- –§–æ—Ä–º—É–ª–∞ -->
                    <div class="help-formula-card">
                        <h4>üìê –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á—ë—Ç–∞ Priority Score</h4>
                        <p class="formula-text">Score = (Value √ó Reach √ó Budget Impact) √ó Confidence</p>
                        <p class="formula-desc">–ì–¥–µ Confidence –≤—ã—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (0-100), –∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ - –≤ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö.</p>
                    </div>

                    <!-- –ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ä—è–¥ -->
                    <div class="help-metrics-row">
                        <div class="help-metric-card">
                            <h4>Value (1-5)</h4>
                            <div class="metric-items">
                                <div class="metric-item">1 ‚Äî ¬´–£–¥–æ–±–Ω–æ¬ª</div>
                                <div class="metric-item">3 ‚Äî ¬´–°–Ω–∏–º–∞–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω—É—é –±–æ–ª—å¬ª</div>
                                <div class="metric-item">5 ‚Äî ¬´–ú–µ–Ω—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π¬ª</div>
                            </div>
                        </div>
                        <div class="help-metric-card">
                            <h4>Reach (1-5)</h4>
                            <div class="metric-items">
                                <div class="metric-item">1 ‚Äî –µ–¥–∏–Ω–∏—á–Ω—ã–µ –∫–µ–π—Å—ã</div>
                                <div class="metric-item">3 ‚Äî –∑–Ω–∞—á–∏–º—ã–π —Å–µ–≥–º–µ–Ω—Ç</div>
                                <div class="metric-item">5 ‚Äî –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                            </div>
                        </div>
                    </div>

                    <div class="help-metrics-row">
                        <div class="help-metric-card">
                            <h4>Budget Impact</h4>
                            <div class="metric-items">
                                <div class="metric-item">1.0 ‚Äî –ë–µ–∑ –∑–∞–º–µ—Ç–Ω–æ–≥–æ –∏–º–ø–∞–∫—Ç–∞</div>
                                <div class="metric-item">1.2 ‚Äî –ù–µ–±–æ–ª—å—à–æ–π –ø—Ä–∏—Ä–æ—Å—Ç</div>
                                <div class="metric-item">1.5 ‚Äî –ó–Ω–∞—á–∏–º—ã–π –ø—Ä–∏—Ä–æ—Å—Ç</div>
                                <div class="metric-item">2.0 ‚Äî –í—ã—Å–æ–∫–∏–π —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç</div>
                            </div>
                        </div>
                        <div class="help-metric-card">
                            <h4>Confidence (0-100%)</h4>
                            <div class="metric-items">
                                <div class="metric-item">100% ‚Äî –µ—Å—Ç—å –≥–æ—Ç–æ–≤–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</div>
                                <div class="metric-item">80% ‚Äî –µ—Å—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –¶–ê</div>
                                <div class="metric-item">60% ‚Äî –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</div>
                                <div class="metric-item">40% ‚Äî –≥–∏–ø–æ—Ç–µ–∑–∞ –∏ —Å–∏–≥–Ω–∞–ª—ã</div>
                                <div class="metric-item">20% ‚Äî –∏–Ω—Ç—É–∏—Ü–∏—è</div>
                                <div class="metric-item">0% ‚Äî –Ω–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∏–π</div>
                            </div>
                        </div>
                    </div>

                    <!-- –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è Score -->
                    <div class="help-interpretation">
                        <h3 style="margin-top: 32px; margin-bottom: 16px;">–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è Score</h3>
                        <table class="help-table">
                            <thead>
                                <tr>
                                    <th>Score</th>
                                    <th>–†–µ—à–µ–Ω–∏–µ –ø–æ —Ñ–∏—á–µ</th>
                                    <th>–ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="score-high-row">
                                    <td><strong>35‚Äì50</strong></td>
                                    <td><strong>–ë–µ—Ä—ë–º –≤ —Ä–∞–±–æ—Ç—É</strong></td>
                                    <td>–§–∏—á–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø–µ—Ä–µ–¥–∞—á–µ –≤ –ø—Ä–æ–¥—É–∫—Ç / –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ delivery. –¶–µ–Ω–Ω–æ—Å—Ç—å, –æ—Ö–≤–∞—Ç –∏ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã.</td>
                                </tr>
                                <tr class="score-medium-row">
                                    <td><strong>20‚Äì34</strong></td>
                                    <td><strong>–ö–∞–Ω–¥–∏–¥–∞—Ç –≤ —Ä–∞–±–æ—Ç—É</strong></td>
                                    <td>–§–∏—á–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π: effort, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —Ç–∞–π–º–∏–Ω–≥. –ò–¥—ë—Ç –≤ –≤–µ—Ä—Ö –±—ç–∫–ª–æ–≥–∞.</td>
                                </tr>
                                <tr class="score-low-row">
                                    <td><strong>8‚Äì19</strong></td>
                                    <td><strong>–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ç–æ—á–Ω–µ–Ω–∏–µ (Discovery)</strong></td>
                                    <td>–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –µ—Å—Ç—å, –Ω–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏–ª–∏ –º–∞—Å—à—Ç–∞–±–∞. –ù—É–∂–Ω—ã —Ä–µ—Å–µ—Ä—á, –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ—Ç–æ—Ç–∏–ø –∏–ª–∏ spike.</td>
                                </tr>
                                <tr class="score-none-row">
                                    <td><strong>0‚Äì7</strong></td>
                                    <td><strong>–ù–µ –±–µ—Ä—ë–º –≤ —Ä–∞–±–æ—Ç—É</strong></td>
                                    <td>–ò–¥–µ—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Icebox. –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–≤–æ–¥–Ω—ã—Ö (–¥–∞–Ω–Ω—ã–µ, –∫–æ–Ω—Ç–µ–∫—Å—Ç, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è).</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- –†–∞–∑–¥–µ–ª 2: –ö–∞–∫ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ -->
                <div id="doc-decision" class="doc-section">
                    <h3>üß† –ö–∞–∫ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ</h3>
                    <p>–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –ø–æ–º–æ–≥–∞–µ—Ç –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á.</p>

                    <div class="doc-step">
                        <div class="doc-step-title">
                            <span class="doc-step-number">1</span>
                            <span>–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ü–µ–ª—å (–æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å ¬´–ó–∞—á–µ–º?¬ª)</span>
                        </div>
                        <div class="doc-step-content">
                            <p>–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —á—ë—Ç–∫–æ –ø–æ–Ω—è—Ç—å:</p>
                            <ul>
                                <li>–∑–∞—á–µ–º –º—ã –¥–µ–ª–∞–µ–º —ç—Ç—É —Ñ–∏—á—É;</li>
                                <li>–∫–∞–∫—É—é –ø—Ä–æ–±–ª–µ–º—É –æ–Ω–∞ —Ä–µ—à–∞–µ—Ç;</li>
                                <li>–¥–ª—è –∫–æ–≥–æ –æ–Ω–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –±–∏–∑–Ω–µ—Å, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∫–æ–º–∞–Ω–¥–∞);</li>
                                <li>–∫–∞–∫—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å –æ–Ω–∞ –ø—Ä–∏–Ω–æ—Å–∏—Ç.</li>
                            </ul>
                            <p><strong>–ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å ¬´–∑–∞—á–µ–º¬ª, —Ä–µ—à–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è.</strong></p>
                        </div>
                    </div>

                    <div class="doc-step">
                        <div class="doc-step-title">
                            <span class="doc-step-number">2</span>
                            <span>–°—Ä–∞–≤–Ω–∏—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ä–µ—à–µ–Ω–∏–µ–º</span>
                        </div>
                        <div class="doc-step-content">
                            <p>–î–∞–ª–µ–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ä–µ—à–µ–Ω–∏–µ —ç—Ç–æ–π –∑–∞–¥–∞—á–∏:</p>
                            <ul>
                                <li>—Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ—Ö–æ–∂–∞—è —Ñ–∏—á–∞ –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å;</li>
                                <li>—á–µ–º –Ω–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ;</li>
                                <li>—É–ª—É—á—à–∞–µ—Ç –ª–∏ –æ–Ω–æ –º–µ—Ç—Ä–∏–∫–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –∏–ª–∏ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã;</li>
                                <li>–º–æ–∂–Ω–æ –ª–∏ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ.</li>
                            </ul>
                            <p><strong>–¶–µ–ª—å —à–∞–≥–∞</strong> ‚Äî –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ª–∏—à–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.</p>
                        </div>
                    </div>

                    <div class="doc-step">
                        <div class="doc-step-title">
                            <span class="doc-step-number">3</span>
                            <span>–û—Ü–µ–Ω–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –±—é–¥–∂–µ—Ç (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)</span>
                        </div>
                        <div class="doc-step-content">
                            <p>–ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è, –Ω—É–∂–Ω–æ:</p>
                            <ul>
                                <li>–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏;</li>
                                <li>–æ—Ü–µ–Ω–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—É—é —ç–∫–æ–Ω–æ–º–∏—é –∏–ª–∏ —Ä–æ—Å—Ç –¥–æ—Ö–æ–¥–∞;</li>
                                <li>–ø–æ–Ω—è—Ç—å, —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –ª–∏ —Ä–µ—à–µ–Ω–∏–µ –≤ —Ç–µ–∫—É—â–∏–π –±—é–¥–∂–µ—Ç.</li>
                            </ul>
                            <p>–≠—Ç–æ—Ç —à–∞–≥ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç—å –≤–∑–≤–µ—à–µ–Ω–Ω–æ–µ –±–∏–∑–Ω–µ—Å-—Ä–µ—à–µ–Ω–∏–µ.</p>
                        </div>
                    </div>

                    <div class="doc-step">
                        <div class="doc-step-title">
                            <span class="doc-step-number">4</span>
                            <span>–û—Ü–µ–Ω–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –≤—Ä–µ–º—è (–µ—Å–ª–∏ –±—é–¥–∂–µ—Ç –ø–æ—Å—á–∏—Ç–∞—Ç—å –Ω–µ–ª—å–∑—è)</span>
                        </div>
                        <div class="doc-step-content">
                            <p>–ï—Å–ª–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –æ—Ü–µ–Ω–∫—É —Å–¥–µ–ª–∞—Ç—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:</p>
                            <ul>
                                <li>–æ—Ü–µ–Ω–∏—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ);</li>
                                <li>–ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç –æ—Ç–ª–æ–∂–µ–Ω—ã –∏–ª–∏ –≤—ã—Ç–µ—Å–Ω–µ–Ω—ã;</li>
                                <li>–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ä–æ—á–Ω–æ—Å—Ç—å –∏ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ roadmap.</li>
                            </ul>
                            <p>–í—Ä–µ–º—è –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—â–∏–π —Ä–µ—Å—É—Ä—Å.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</dialog>

<!-- Modal –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –≤ –ö–∞–Ω–±–∞–Ω -->
<dialog class="modal" id="moveToKanbanModal">
    <div class="modal-content modal-large glass-modal">
        <div class="modal-header">
            <h2>–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –ö–∞–Ω–±–∞–Ω</h2>
            <button class="close-btn" onclick="closeMoveToKanbanModal()">
                <span class="material-icons-round">close</span>
            </button>
        </div>
        <form id="moveToKanbanForm">
            <input type="hidden" id="moveIdeaId">

            <div class="form-group">
                <label for="moveTitle">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                <input type="text" id="moveTitle" name="title" required>
            </div>

            <div class="form-group">
                <label for="moveIdeichnayaLink">–°—Å—ã–ª–∫–∞ –Ω–∞ –ò–¥–µ–∏—á–Ω—É—é</label>
                <input type="url" id="moveIdeichnayaLink" name="ideichnaya_link" placeholder="https://...">
            </div>

            <div class="form-group">
                <label for="moveDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="moveDescription" name="description" rows="3"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="moveAssignee">–ü–æ—Å—Ç–∞–Ω–æ–≤—â–∏–∫</label>
                    <input type="text" id="moveAssignee" name="assignee" placeholder="–ò–º—è">
                </div>
                <div class="form-group">
                    <label for="moveExecutor">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</label>
                    <input type="text" id="moveExecutor" name="executor" placeholder="–ò–º—è">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="movePriority">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                    <select id="movePriority" name="priority">
                        <option value="Low">Low</option>
                        <option value="Medium" selected>Medium</option>
                        <option value="High">High</option>
                        <option value="Highest">Highest</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="moveStatus">–°—Ç–∞—Ç—É—Å</label>
                    <select id="moveStatus" name="status">
                        <option value="New">New</option>
                        <option value="Collecting">Collecting</option>
                        <option value="Ready for Dev">Ready for Dev</option>
                        <option value="In Dev">In Dev</option>
                        <option value="Ready for Release">Ready for Release</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>–¢–µ–≥–∏</label>
                <div id="moveTagsContainer" class="tags-container"></div>
            </div>

            <div class="form-section">
                <h3>
                    <span class="material-icons-round">grid_view</span>
                    –ú–∞—Ç—Ä–∏—Ü–∞ –≠–π–∑–µ–Ω—Ö–∞—É—ç—Ä–∞
                </h3>
                <p class="form-hint">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ –æ–¥–Ω–æ–º—É –ø—É–Ω–∫—Ç—É –∏–∑ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º</p>
                <div class="eisenhower-matrix">
                    <div class="eisenhower-block">
                        <span class="block-title">–í–∞–∂–Ω–æ—Å—Ç—å</span>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="move_eisenhower_importance" value="important">
                                <span class="radio-custom"></span>
                                <span>–í–∞–∂–Ω–æ</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="move_eisenhower_importance" value="not_important">
                                <span class="radio-custom"></span>
                                <span>–ù–µ –≤–∞–∂–Ω–æ</span>
                            </label>
                        </div>
                    </div>
                    <div class="eisenhower-block">
                        <span class="block-title">–°—Ä–æ—á–Ω–æ—Å—Ç—å</span>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="move_eisenhower_urgency" value="urgent">
                                <span class="radio-custom"></span>
                                <span>–°—Ä–æ—á–Ω–æ</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="move_eisenhower_urgency" value="not_urgent">
                                <span class="radio-custom"></span>
                                <span>–ù–µ —Å—Ä–æ—á–Ω–æ</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div id="moveEisenhowerError" class="form-error" style="display: none;">
                    –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ –æ–¥–Ω–æ–º—É –ø—É–Ω–∫—Ç—É –∏–∑ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –æ–±–∞ –ø—É—Å—Ç—ã–º–∏
                </div>
            </div>

            <div class="rice-preview">
                <h4>VRC –º–µ—Ç—Ä–∏–∫–∏ (–∏–∑ –∏–¥–µ–∏)</h4>
                <div class="rice-metrics-preview" id="riceMetricsPreview"></div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeMoveToKanbanModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">
                    <span class="material-icons-round">move_to_inbox</span>
                    –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –ö–∞–Ω–±–∞–Ω
                </button>
            </div>
        </form>
    </div>
</dialog>
{% endblock modals %}

{% block scripts %}
<script>
    let ricePageTags = [];
    let selectedMoveTags = [];
    let currentIdea = null;

    document.addEventListener('DOMContentLoaded', function() {
        loadRiceIdeas();
        loadRicePageTags();

        document.getElementById('riceIdeaForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await saveRiceIdea();
        });

        document.getElementById('moveToKanbanForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await moveToKanban();
        });
    });

    async function loadRicePageTags() {
        try {
            const response = await fetch('/api/tags');
            ricePageTags = await response.json();
        } catch (error) {
            console.error('Error loading tags:', error);
        }
    }

    async function loadRiceIdeas() {
        try {
            const response = await fetch('/api/rice-ideas');
            let ideas = await response.json();

            const tbody = document.getElementById('riceIdeasBody');
            const emptyState = document.getElementById('emptyState');
            tbody.innerHTML = '';

            if (ideas.length === 0) {
                emptyState.style.display = 'flex';
                return;
            }
            emptyState.style.display = 'none';

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ score (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
            ideas.sort((a, b) => (b.rice_score || 0) - (a.rice_score || 0));

            ideas.forEach((idea, index) => {
                const row = document.createElement('tr');
                const scoreClass = getScoreClass(idea.rice_score);

                row.innerHTML = `
                    <td class="task-cell">
                        <div class="task-info">
                            <span class="task-rank">#${index + 1}</span>
                            <div class="idea-details">
                                <span class="idea-title">${idea.title}</span>
                                ${idea.description ? `<span class="idea-desc">${idea.description.substring(0, 50)}${idea.description.length > 50 ? '...' : ''}</span>` : ''}
                            </div>
                        </div>
                    </td>
                    <td>
                        <select class="rice-select" onchange="updateRiceIdea(${idea.id}, 'value', this.value)">
                            <option value="">‚Äî</option>
                            ${[1,2,3,4,5].map(i =>
                                `<option value="${i}" ${idea.value === i ? 'selected' : ''}>${i}</option>`
                            ).join('')}
                        </select>
                    </td>
                    <td>
                        <select class="rice-select" onchange="updateRiceIdea(${idea.id}, 'reach', this.value)">
                            <option value="">‚Äî</option>
                            ${[1,2,3,4,5].map(i =>
                                `<option value="${i}" ${idea.reach === i ? 'selected' : ''}>${i}</option>`
                            ).join('')}
                        </select>
                    </td>
                    <td>
                        <select class="rice-select" onchange="updateRiceIdea(${idea.id}, 'budget_impact', this.value)">
                            <option value="">‚Äî</option>
                            <option value="1.0" ${idea.budget_impact === 1.0 || !idea.budget_impact ? 'selected' : ''}>1.0</option>
                            <option value="1.2" ${idea.budget_impact === 1.2 ? 'selected' : ''}>1.2</option>
                            <option value="1.5" ${idea.budget_impact === 1.5 ? 'selected' : ''}>1.5</option>
                            <option value="2.0" ${idea.budget_impact === 2.0 ? 'selected' : ''}>2.0</option>
                        </select>
                    </td>
                    <td>
                        <input type="number" class="rice-input" value="${idea.confidence ?? ''}"
                               onchange="updateRiceIdea(${idea.id}, 'confidence', this.value)"
                               min="0" max="100" placeholder="0-100">
                    </td>
                    <td class="score-col">
                        <span class="rice-score ${scoreClass}">
                            ${idea.rice_score !== null ? idea.rice_score.toFixed(2) : '‚Äî'}
                        </span>
                    </td>
                    <td class="actions-cell">
                        <button class="icon-btn" onclick="editRiceIdea(${idea.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                            <span class="material-icons-round">edit</span>
                        </button>
                        <button class="icon-btn success" onclick="openMoveToKanbanModal(${idea.id})" title="–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –ö–∞–Ω–±–∞–Ω">
                            <span class="material-icons-round">move_to_inbox</span>
                        </button>
                        <button class="icon-btn danger" onclick="deleteRiceIdea(${idea.id})" title="–£–¥–∞–ª–∏—Ç—å">
                            <span class="material-icons-round">delete</span>
                        </button>
                    </td>
                `;

                tbody.appendChild(row);
            });
        } catch (error) {
            console.error('Error loading Priority Score ideas:', error);
        }
    }

    function getScoreClass(score) {
        if (score === null || score === undefined) return '';
        if (score >= 35) return 'score-high';      // –ë–µ—Ä—ë–º –≤ —Ä–∞–±–æ—Ç—É
        if (score >= 20) return 'score-medium';    // –ö–∞–Ω–¥–∏–¥–∞—Ç –≤ —Ä–∞–±–æ—Ç—É
        if (score >= 8) return 'score-low';        // –¢—Ä–µ–±—É–µ—Ç—Å—è Discovery
        return 'score-none';                        // –ù–µ –±–µ—Ä—ë–º –≤ —Ä–∞–±–æ—Ç—É
    }

    // === Modal –¥–ª—è Priority Score –∏–¥–µ–∏ ===

    function openRiceIdeaModal(idea = null) {
        const modal = document.getElementById('riceIdeaModal');
        const title = document.getElementById('riceIdeaModalTitle');
        const form = document.getElementById('riceIdeaForm');

        if (idea) {
            title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–¥–µ—é';
            document.getElementById('riceIdeaId').value = idea.id;
            document.getElementById('riceIdeaTitle').value = idea.title || '';
            document.getElementById('riceIdeaDescription').value = idea.description || '';
            document.getElementById('riceIdeaValue').value = idea.value || '';
            document.getElementById('riceIdeaReach').value = idea.reach || '';
            document.getElementById('riceIdeaBudget').value = idea.budget_impact || '1.0';
            document.getElementById('riceIdeaConfidence').value = idea.confidence ?? '';
        } else {
            title.textContent = '–ù–æ–≤–∞—è Priority Score-–∏–¥–µ—è';
            form.reset();
            document.getElementById('riceIdeaId').value = '';
        }

        if (modal.tagName === 'DIALOG') {
            modal.showModal();
        } else {
            modal.classList.add('active');
        }
    }

    function closeRiceIdeaModal() {
        const modal = document.getElementById('riceIdeaModal');
        if (modal.tagName === 'DIALOG') {
            modal.close();
        } else {
            modal.classList.remove('active');
        }
    }

    // === Modal —Å–ø—Ä–∞–≤–∫–∏ ===

    function openHelpModal() {
        const modal = document.getElementById('helpModal');
        if (modal.tagName === 'DIALOG') {
            modal.showModal();
        } else {
            modal.classList.add('active');
        }
        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —Ä–∞–∑–¥–µ–ª
        switchDocSection('metrics');
    }

    function closeHelpModal() {
        const modal = document.getElementById('helpModal');
        if (modal.tagName === 'DIALOG') {
            modal.close();
        } else {
            modal.classList.remove('active');
        }
    }

    function switchDocSection(sectionId) {
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é
        document.querySelectorAll('.doc-section').forEach(section => {
            section.classList.remove('active');
        });
        document.querySelectorAll('.doc-menu-item').forEach(item => {
            item.classList.remove('active');
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ä–∞–∑–¥–µ–ª—É
        const section = document.getElementById('doc-' + sectionId);
        if (section) {
            section.classList.add('active');
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –ø—É–Ω–∫—Ç—É –º–µ–Ω—é
        event.currentTarget.classList.add('active');
    }

    async function editRiceIdea(id) {
        try {
            const response = await fetch(`/api/rice-ideas/${id}`);
            const idea = await response.json();
            openRiceIdeaModal(idea);
        } catch (error) {
            console.error('Error loading idea:', error);
        }
    }

    async function saveRiceIdea() {
        const id = document.getElementById('riceIdeaId').value;
        const data = {
            title: document.getElementById('riceIdeaTitle').value,
            description: document.getElementById('riceIdeaDescription').value,
            value: parseInt(document.getElementById('riceIdeaValue').value) || null,
            reach: parseInt(document.getElementById('riceIdeaReach').value) || null,
            budget_impact: parseFloat(document.getElementById('riceIdeaBudget').value) || 1.0,
            confidence: parseInt(document.getElementById('riceIdeaConfidence').value) ?? null
        };

        try {
            const url = id ? `/api/rice-ideas/${id}` : '/api/rice-ideas';
            const method = id ? 'PUT' : 'POST';

            const response = await fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                closeRiceIdeaModal();
                loadRiceIdeas();
            }
        } catch (error) {
            console.error('Error saving idea:', error);
        }
    }

    async function updateRiceIdea(id, field, value) {
        try {
            // –î–ª—è budget_impact –∏—Å–ø–æ–ª—å–∑—É–µ–º parseFloat, –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö parseInt
            let parsedValue;
            if (field === 'budget_impact') {
                parsedValue = value ? parseFloat(value) : null;
            } else {
                parsedValue = value ? parseInt(value) : null;
            }

            const response = await fetch(`/api/rice-ideas/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ [field]: parsedValue })
            });

            if (response.ok) {
                loadRiceIdeas();
            }
        } catch (error) {
            console.error('Error updating Priority Score idea:', error);
        }
    }

    async function deleteRiceIdea(id) {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∏–¥–µ—é?')) return;

        try {
            const response = await fetch(`/api/rice-ideas/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                loadRiceIdeas();
            }
        } catch (error) {
            console.error('Error deleting idea:', error);
        }
    }

    // === Modal –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –≤ –ö–∞–Ω–±–∞–Ω ===

    async function openMoveToKanbanModal(id) {
        try {
            const response = await fetch(`/api/rice-ideas/${id}`);
            currentIdea = await response.json();

            document.getElementById('moveIdeaId').value = currentIdea.id;
            document.getElementById('moveTitle').value = currentIdea.title || '';
            document.getElementById('moveDescription').value = currentIdea.description || '';
            document.getElementById('moveIdeichnayaLink').value = '';
            document.getElementById('moveAssignee').value = '';
            document.getElementById('moveExecutor').value = '';
            document.getElementById('movePriority').value = 'Medium';
            document.getElementById('moveStatus').value = 'New';

            // –°–±—Ä–æ—Å radio-–∫–Ω–æ–ø–æ–∫ –º–∞—Ç—Ä–∏—Ü—ã –≠–π–∑–µ–Ω—Ö–∞—É—ç—Ä–∞
            document.querySelectorAll('input[name="move_eisenhower_importance"]').forEach(el => el.checked = false);
            document.querySelectorAll('input[name="move_eisenhower_urgency"]').forEach(el => el.checked = false);
            document.getElementById('moveEisenhowerError').style.display = 'none';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º VRC –º–µ—Ç—Ä–∏–∫–∏
            document.getElementById('riceMetricsPreview').innerHTML = `
                <span class="metric">Value: <strong>${currentIdea.value || '‚Äî'}</strong></span>
                <span class="metric">Reach: <strong>${currentIdea.reach || '‚Äî'}</strong></span>
                <span class="metric">Confidence: <strong>${currentIdea.confidence !== null ? currentIdea.confidence + '%' : '‚Äî'}</strong></span>
                <span class="metric score">Score: <strong>${currentIdea.rice_score !== null ? currentIdea.rice_score.toFixed(2) : '‚Äî'}</strong></span>
            `;

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–≥–∏
            selectedMoveTags = [];
            renderMoveTags();

            document.getElementById('moveToKanbanModal').classList.add('active');
        } catch (error) {
            console.error('Error loading idea:', error);
        }
    }

    function closeMoveToKanbanModal() {
        document.getElementById('moveToKanbanModal').classList.remove('active');
        currentIdea = null;
    }

    function renderMoveTags() {
        const container = document.getElementById('moveTagsContainer');
        container.innerHTML = ricePageTags.map(tag => `
            <label class="tag-checkbox" style="--tag-color: ${tag.color}">
                <input type="checkbox" value="${tag.id}"
                       ${selectedMoveTags.includes(tag.id) ? 'checked' : ''}
                       onchange="toggleMoveTag(${tag.id})">
                <span class="tag-label">${tag.name}</span>
            </label>
        `).join('');
    }

    function toggleMoveTag(tagId) {
        if (selectedMoveTags.includes(tagId)) {
            selectedMoveTags = selectedMoveTags.filter(id => id !== tagId);
        } else {
            selectedMoveTags.push(tagId);
        }
    }

    function validateMoveEisenhower() {
        const importance = document.querySelector('input[name="move_eisenhower_importance"]:checked');
        const urgency = document.querySelector('input[name="move_eisenhower_urgency"]:checked');
        const errorEl = document.getElementById('moveEisenhowerError');

        // –û–±–∞ –ø—É—Å—Ç—ã–µ - –û–ö
        if (!importance && !urgency) {
            errorEl.style.display = 'none';
            return true;
        }

        // –û–±–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã - –û–ö
        if (importance && urgency) {
            errorEl.style.display = 'none';
            return true;
        }

        // –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω - –æ—à–∏–±–∫–∞
        errorEl.style.display = 'block';
        return false;
    }

    async function moveToKanban() {
        if (!validateMoveEisenhower()) {
            return;
        }

        const id = document.getElementById('moveIdeaId').value;
        const importance = document.querySelector('input[name="move_eisenhower_importance"]:checked');
        const urgency = document.querySelector('input[name="move_eisenhower_urgency"]:checked');

        const data = {
            title: document.getElementById('moveTitle').value,
            description: document.getElementById('moveDescription').value,
            ideichnaya_link: document.getElementById('moveIdeichnayaLink').value,
            assignee: document.getElementById('moveAssignee').value,
            executor: document.getElementById('moveExecutor').value,
            priority: document.getElementById('movePriority').value,
            status: document.getElementById('moveStatus').value,
            eisenhower_urgent: urgency ? urgency.value === 'urgent' : null,
            eisenhower_important: importance ? importance.value === 'important' : null,
            tag_ids: selectedMoveTags
        };

        try {
            const response = await fetch(`/api/rice-ideas/${id}/to-kanban`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                closeMoveToKanbanModal();
                loadRiceIdeas();
                alert('–ò–¥–µ—è —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ –ö–∞–Ω–±–∞–Ω!');
            }
        } catch (error) {
            console.error('Error moving to kanban:', error);
        }
    }
</script>
{% endblock %}
